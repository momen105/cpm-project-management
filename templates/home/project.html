{% extends 'base.html' %}

{% block component %}
<div class="d-flex justify-content-between">
    <h3 class="m-3">Task Details</h3>
    <button type="button" class="btn  m-3 custom-button" data-bs-toggle="modal" data-bs-target="#addProjectModal">
        + Add Project
    </button>
</div>

<div class="">
  <table class="task-list ">
    <thead class="table-light">
      <tr>
        <th>ID</th>
        <th>Project Name</th>
        <th>Created date</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
        {% for item in data %}
        <tr>

            <td>{{ forloop.counter }}</td>
            <td>{{item.name}}</td>
            <td>{{item.created_at}}</td>
            <td >
                <a class="action-button" href="{% url 'project_details' id=item.id %}"><i class="fa-regular fa-eye"></i></a>
                <a  class="action-button me-1" data-bs-toggle="modal" data-bs-target="#editProjectModal" data-id="{{item.id}}" data-name="{{item.name}}">
                    <i class="fa-solid fa-pen-to-square"></i>
                </a>
                <a  class="action-button btn-delete" data-id="{{item.id}}">
                  <i class="fa-solid fa-trash"></i>
              </a>

            </td>
        </tr>
        {% endfor %}
    </tbody>
  </table>
</div>

<div class="modal fade" id="addProjectModal" tabindex="-1" aria-labelledby="addProjectModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form method="POST" >
        {% csrf_token %}
        <div class="modal-header">
          <h5 class="modal-title" id="addProjectModalLabel">New Project</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">

          <div class="mb-3">
            <label for="Name" class="form-label">Name</label>
            <textarea class="form-control" id="Name" name="name" rows="2" required></textarea>
          </div>

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="submit" class="btn btn-primary">Add Project</button>
        </div>
      </form>
    </div>
  </div>
</div>

<div class="modal fade" id="editProjectModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form method="POST" action="{% url 'project_list' %}">
        {% csrf_token %}
        <div class="modal-header">
          <h5 class="modal-title">Edit Project</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
           <input type="hidden" name="id" id="editProjectId">
          <div class="mb-3">
            <label class="form-label">Project Name</label>
            <textarea class="form-control" name="name" id="editProjectName" rows="2" required></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="submit" class="btn btn-primary">Update</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
      let editModal = document.getElementById('editProjectModal');
    editModal.addEventListener('show.bs.modal', function (event) {
        let button = event.relatedTarget;  // যেই button modal open করেছে
        let id = button.getAttribute('data-id');
        let name = button.getAttribute('data-name');

        // form fields এ value বসানো
        document.getElementById('editProjectId').value = id;
        document.getElementById('editProjectName').value = name;
    });

    document.querySelectorAll(".btn-delete").forEach(button => {
    button.addEventListener("click", function(){
        let projectId = this.getAttribute("data-id");

        Swal.fire({
            title: "Are you sure?",
            text: "This will permanently delete the project!",
            icon: "warning",
            showCancelButton: true,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: "Yes, delete it!"
        }).then((result) => {
            if (result.isConfirmed) {
                fetch(`/projects/${projectId}/`, {
                    method: "DELETE",
                    headers: {
                        "X-CSRFToken": "{{ csrf_token }}"
                    }
                }).then(res => res.json())
                .then(data => {
                    if(data.success){
                        Swal.fire("Deleted!", "Task has been deleted.", "success")
                        .then(() => location.reload());
                    }
                });
            }
        })
    });
});
</script>

{% endblock component %}

